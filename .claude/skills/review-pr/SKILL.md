---
name: review-pr
description: gh CLIを使ってPull Requestのコードレビューを実行し、構造化されたフィードバックをPRコメントとして投稿する
argument-hint: "[PR番号(任意)]"
allowed-tools:
  - Bash(gh pr *)
  - Bash(gh api *)
  - Read
  - Glob
  - Grep
  - WebFetch
  - WebSearch
---

# PR Code Reviewer

Pull Requestの分析とフィードバックを専門とするコードレビュースキル。

## 手順

### 1. ghコマンドの確認

`gh`コマンドが利用可能であることを確認する。利用できない場合はレビューを続行できないことを通知する。

### 2. PR情報の取得

- `$ARGUMENTS`でPR番号が指定されている場合はそれを使用する
- 指定がない場合は`gh pr list`で一覧を表示し、ユーザーに確認する
- `gh pr view <PR番号>`でPRの詳細を取得する
- `gh pr diff <PR番号>`で差分を取得する

### 3. 包括的なコードレビュー

以下の観点でコード変更を評価する:

- CLAUDE.mdからのプロジェクトのコーディング標準とパターンへの準拠
- コード品質、可読性、保守性
- Result<T, E>パターンを使用した適切なエラーハンドリング
- TypeScript型とZodバリデーションの適切な使用
- テストカバレッジと品質
- セキュリティ考慮事項
- パフォーマンスへの影響
- アーキテクチャへの準拠（DDDパターン、クリーンアーキテクチャ）

### 4. レビューチェックリスト

- すべてのAPIエンドポイントでリクエストバリデーションにzodValidatorを使用しているか
- 適切なインポートパターン（src/からの絶対インポート）か
- サービス層での正しいエラーハンドリングか
- 全レイヤーにわたる適切なテストカバレッジがあるか
- Conventional Commitsフォーマットに準拠しているか
- データベーススキーマ変更が確立されたパターンに従っているか
- フロントエンドコンポーネントが確立されたUIパターンに従っているか

### 5. 構造化されたフィードバック

コメントには以下のprefixをつける:

- `[must]`: かならず変更してね
- `[imo]`: 自分の意見だとこうだけど修正必須ではないよ(in my opinion)
- `[nits]`: ささいな指摘(nitpick)
- `[ask]`: 質問
- `[fyi]`: 参考情報

フィードバックは:
- 具体的で実行可能
- 改善を提案する際のコード例を含む
- 特定の行やファイルを参照
- 推奨事項の背後にある理由を説明

### 6. 品質ゲート

マージを阻止する問題をフラグする:
- 不足または不適切なテスト
- セキュリティ脆弱性
- 適切な移行なしの破壊的変更
- アーキテクチャパターンへの非準拠
- 必須バリデーションの欠如

### 7. 要約レポート

以下で結論する:
- PRの全体的な評価
- 主な強みと改善点
- 推奨事項（承認、変更要求、または議論が必要）
- 必要なフォローアップアクション

### 8. PRにコメントとして投稿

1. タイトルは必ず`Claude Code Review`にする
2. 以前作成したreviewをhideする
   - `Claude Code Review`というタイトルのコメントをすべて取得し、`gh api`コマンドで非表示にする
3. レビューが完了したら`gh pr review <PR番号> --comment --body "$REPORT_BODY"`で投稿する

## ルール

- 良いプラクティス、巧妙な解決策、コードの改善も認める
- 敬語は使用しない（日本語）
- 徹底的でありながら建設的であることに重点を置く
