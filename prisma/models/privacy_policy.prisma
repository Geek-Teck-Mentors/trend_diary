/// プライバシーポリシーのバージョン管理テーブル
/// バージョンごとに内容と有効期間を記録し、変更履歴を保持
model PrivacyPolicy {
  /// プライバシーポリシーのバージョン番号（自動増分）
  version     Int       @id @default(autoincrement())
  /// プライバシーポリシーの内容（全文）
  content     String    @db.Text
  /// プライバシーポリシーの制定日・有効開始日
  effectiveAt DateTime? @map("effective_at") @db.Timestamptz()

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz()

  @@map("privacy_policies")
}

/// ユーザーのプライバシーポリシー同意履歴テーブル
/// ユーザーがいつどのバージョンに同意したかを記録
model PrivacyPolicyConsent {
  /// 同意したユーザーID
  userId        BigInt   @map("user_id") @db.BigInt
  /// 同意したプライバシーポリシーのバージョン
  policyVersion Int      @map("policy_version")
  /// プライバシーポリシーに同意した日時
  consentedAt   DateTime @default(now()) @map("consented_at") @db.Timestamptz()

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz()

  user User @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([userId, policyVersion])
  @@map("privacy_policy_consents")
}
