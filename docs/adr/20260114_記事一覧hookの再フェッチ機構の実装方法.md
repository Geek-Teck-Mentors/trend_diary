# 記事一覧hookの再フェッチ機構の実装方法
<!-- Title という文字を消してこの ADR のタイトルを書いてください -->

Status: Accepted
<!-- プルリクベースで開発するので、プルリクを作る段で Accepted の状態でOK -->
<!-- 別のADRによって置き換えられた場合 Replaced by #{ADR No.} に変更 -->
<!-- 明らかに不要になった場合 Deprecated に変更 -->

Relevant PR:

https://github.com/Geek-Teck-Mentors/trend_diary/pull/428
<!-- reference できるプルリクがあればそのリンクを貼ってください -->


# Context
もともと通常のリクエストのみを送っていた`articles`(記事一覧)のhookの機構を`SWR`を用いた再フェッチ可能な仕組みに変更を行った。
その際に、クエリパラメータの変更とともに再フェッチの方法をどのように実装するかを検討した。

## References

[SWR公式Docs: API](https://swr.vercel.app/ja/docs/api)
[SWR公式Docs: mutate](https://swr.vercel.app/ja/docs/mutation)

# Decision

`useSWR`の第1引数のkeyにクエリパラメータの内容を含める形で実装を行う。

## Reason

- `useSWR`のkeyにクエリパラメータを含めることで、クエリパラメータが変更された際に自動的に再フェッチが行われるため、実装がシンプルになるため
  - ただし、監視対象のクエリパラメータが多くなるとkeyの内容が複雑になるため、管理が難しくなる可能性があるリスクは残る
- クエリパラメータ更新の際に`mutate`関数を実行して手動で再フェッチを行う方法も試したが、送られるリクエストのクエリパラメータが更新されず、意図した動作にならなかったため断念
  - `mutate`関数を実行したタイミングで`useSWR`のkeyが更新されないため、古いkeyで再フェッチが行われてしまう
- クエリパラメータの変更を`useEffect`で監視して、都度`mutate`関数を実行も検討したが、`useEffect`を用いたくないので見送った
- `useSWR`ではなく`SWR`ライブラリから直接提供されている`mutate`関数を用いる方法も検討したが、`useSWR`の`mutate`関数を用いる方法と同じ結果になるため断念
- `useSWR`のoptionを用いて再フェッチを行う方法も検討したが、クエリパラメータの変更を監視→適切に再フェッチを行うものが存在しなかったため断念(参考: [SWR公式Docs: useSWRのオプション](https://swr.vercel.app/ja/docs/api#options))

# Consequences

この実装により、クエリパラメータの変更に伴う再フェッチが自動的に行われるようになったが、keyの内容が複雑になるためクエリパラメータの管理がやや難しくなる可能性がある。
