# フロントエンドテスト戦略

<!-- Title という文字を消してこの ADR のタイトルを書いてください -->

Status: Accepted

<!-- プルリクベースで開発するので、プルリクを作る段で Accepted の状態でOK -->
<!-- 別のADRによって置き換えられた場合 Replaced by #{ADR No.} に変更 -->
<!-- 明らかに不要になった場合 Deprecated に変更 -->

Relevant PR:

https://github.com/Geek-Teck-Mentors/trend_diary/pull/172

<!-- reference できるプルリクがあればそのリンクを貼ってください -->

# Context

E2Eを導入するにあたり、テストサイズ毎にどの段階のテストを利用するか検討する必要が出た。
そこで、StorybookやPlaywright、テスティングトロフィーの概念で紐解くことにした。

<!-- アーキテクチャ上の判断をするに至った背景や経緯を書いてください -->

## References

- https://speakerdeck.com/yajihum/hurontoendoniokeru-tesutofang-zhen-testing-trophynogai-nian-tobdd

<!-- 判断に使った資料などがあればここにリンクなどを貼ってください -->
<!-- Context の文中に記載しても問題ないです -->

# Decision

<!-- 下した判断を簡潔に書いてください -->

APIとの繋ぎ込みの有無でE2Eかどうか分ける。

- UIコンポーネント（API接続のないもの）→Storybook
  - いわゆるコンポーネント→フロントエンド単体テスト（関数テストのようなもの）
    - 無闇にページコンテナ内で分割する必要はなく、共通利用する場合のみコンポーネントとして切り出す
  - ページコンテナ(page.tsx)→フロントエンドのコンポーネントテスト（単体テストの一部）
    - 基本的な挙動やAPIが関係しないフォーム
- ページテスト（API接続あり）→E2E, playwright
  - APIの関連する挙動を確認する
  - フォームもAPIが関係してエラー表示などがある場合は確認する必要がある
  - E2Eの単体テスト→RemixのページでAPI関連の挙動のみテスト
  - E2Eの結合テスト→ページ間で連携する、API関連の挙動のテスト
  - E2Eのシナリオテスト→ユーザーの一般的かつ頻繁に取る行動パターンでテスト

基本的にはテストピラミッドに合わせた考え方だが
結合テスト（コンポーネント同士の結合、UIコンポーネントテスト）の方が大事であるため、そちらに重きを置く。

## Reason

- フロントエンドのテストを作成する工数削減のため
- 適切にプロダクトの品質を保証するため

<!-- 下した判断の理由を書いてください -->
<!-- Decision の他に検討した選択肢があれば書いてください -->

# Consequences

- 明確に責務と目的が分かれたことで、テストの独立性が向上した
- テストサイズに応じた戦略を取ることで、テストの作成コストが下がった（作成しやすい単体〜結合が多く、難しいE2Eが減る）
<!-- Decisionを適用した結果、その決定がなされる前と後で何が変わったか（良くなったか/悪くなったか）を書いてください。 -->
