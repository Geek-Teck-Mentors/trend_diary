# テストコードの方針

<!-- Title という文字を消してこの ADR のタイトルを書いてください -->

Status: Accepted

<!-- プルリクベースで開発するので、プルリクを作る段で Accepted の状態でOK -->
<!-- 別のADRによって置き換えられた場合 Replaced by #{ADR No.} に変更 -->
<!-- 明らかに不要になった場合 Deprecated に変更 -->

Relevant PR:

<!-- reference できるプルリクがあればそのリンクを貼ってください -->

# Context

バックエンドの単体テストで、トランザクションやデータの重複が発生し、テストの安定性が低下した。
その原因はDBにあり、Prismaの運用方針に問題があった。
viteでモック生成などリポジトリをモックできれば良かったが
使えるライブラリがほとんどなかった。

## References

https://www.prisma.io/blog/testing-series-1-8eRB5p0Y8o

<!-- 判断に使った資料などがあればここにリンクなどを貼ってください -->
<!-- Context の文中に記載しても問題ないです -->

# Decision

- サービス層の単体テストはPrismaのガイドに従ってMockを使う
- API（プレゼン層）の単体テストはDBを使う

## Reason

- サービス層はビジネスロジックのテストを実施したく、DBのテストを兼ねないため。
- 一方で、APIの単体テスト時はDBも確認したいため。
- サービス層とAPIのテストで競合することはあるが、API同士でのテストでデータの競合などは発生しないため。
  <!-- 下した判断の理由を書いてください -->
  <!-- Decision の他に検討した選択肢があれば書いてください -->

全てDBを接続したかったが、データ競合が発生したため、却下した。

# Consequences

- 単体テスト実施時の安定性が向上した
<!-- Decisionを適用した結果、その決定がなされる前と後で何が変わったか（良くなったか/悪くなったか）を書いてください。 -->
